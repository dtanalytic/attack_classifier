schema: '2.0'
stages:
  get_mitre_data:
    cmd: python src/get_mitre_data.py params.yaml
    deps:
    - path: data/external/enterprise-attack.json
      hash: md5
      md5: 694ad1fddfe7a00959c195c36dc6d53e
      size: 43474692
    - path: src/get_mitre_data.py
      hash: md5
      md5: f7ff9e12b51fe79da2635d97847a1703
      size: 5719
    params:
      params.yaml:
        get_data.divide_paras: true
    outs:
    - path: data/interim/label2tactic.json
      hash: md5
      md5: 5189286c02d7aa1ba4b5542d14a5f4aa
      size: 24536
    - path: data/interim/mitre.csv
      hash: md5
      md5: 52936e543e9670900e67964262f23edb
      size: 7876768
    - path: data/interim/mitre_attack.csv
      hash: md5
      md5: d4efdab171ee40b62ecee3b861353b05
      size: 3090191
  get_add_data:
    cmd: python src/get_add_data.py params.yaml
    deps:
    - path: data/external/dataset.txt
      hash: md5
      md5: 8ced30b0a5777f7650930d4c542e0c92
      size: 1847828
    - path: data/external/multi_label.json
      hash: md5
      md5: e144bdea2eeef5f35758704590c1f937
      size: 5882360
    - path: data/external/rep_dn
      hash: md5
      md5: 2f3ce9e25f33af638d449d6a9aa1cd6e.dir
      size: 727579
      nfiles: 25
    - path: data/interim/label2tactic.json
      hash: md5
      md5: 5189286c02d7aa1ba4b5542d14a5f4aa
      size: 24536
    - path: data/interim/mitre.csv
      hash: md5
      md5: 52936e543e9670900e67964262f23edb
      size: 7876768
    - path: data/interim/mitre_attack.csv
      hash: md5
      md5: d4efdab171ee40b62ecee3b861353b05
      size: 3090191
    - path: src/get_add_data.py
      hash: md5
      md5: 6347381c9aeb2259987ece811933f51a
      size: 4854
    params:
      params.yaml:
        get_data.add_empty_reports: false
        get_data.data_fn: data/interim/mitre_full_df.csv
        get_data.target: tactic
        get_data.use_alt_mitre: false
        get_data.use_reports_f: true
        get_data.use_tram_f: true
    outs:
    - path: data/interim/mitre_full_df.csv
      hash: md5
      md5: 854836ff988f04842b4a21ef443a001f
      size: 6105269
  manual_data_filter:
    cmd: python src/manual_data_filter.py params.yaml
    deps:
    - path: data/interim/mitre_full_df.csv
      hash: md5
      md5: 854836ff988f04842b4a21ef443a001f
      size: 6105269
    - path: src/manual_data_filter.py
      hash: md5
      md5: da91c10e74fecef2c77f97ac086ebd36
      size: 935
    outs:
    - path: data/interim/mitre_full_filt_df.csv
      hash: md5
      md5: 7d7f09dec7bcb0bde909eb3efb4ce009
      size: 6107834
  text_preprocess:
    cmd: python src/prep.py params.yaml
    deps:
    - path: data/interim/mitre_full_filt_df.csv
      hash: md5
      md5: 7d7f09dec7bcb0bde909eb3efb4ce009
      size: 6107834
    - path: src/prep.py
      hash: md5
      md5: 4de3ec11e67861fda57d5aeef23bac70
      size: 3867
    params:
      params.yaml:
        prep_text.labelled_text_only: false
        prep_text.lower: false
        prep_text.max_len_token: 10
        prep_text.min_len_token: 3
        prep_text.save_only_words: false
        prep_text.stem_lemm: stem
        prep_text.stop_words: false
        prep_text.ttp_counts_thresh: 15
    outs:
    - path: data/interim/mlb.pkl
      hash: md5
      md5: 59aa9a82e455e7fed9a95b929105bcb9
      size: 1386
    - path: data/interim/prep_df.csv
      hash: md5
      md5: 34e35d2834bce0897cc648d63cb67a09
      size: 23986042
    - path: data/interim/ttp/mlb.pkl
      hash: md5
      md5: eb6bac471d17d59ca62126cf9a931182
      size: 3148
  feature_generation:
    cmd: python src/feat_gen.py params.yaml
    deps:
    - path: data/interim/mlb.pkl
      hash: md5
      md5: 59aa9a82e455e7fed9a95b929105bcb9
      size: 1386
    - path: data/interim/prep_df.csv
      hash: md5
      md5: 34e35d2834bce0897cc648d63cb67a09
      size: 23986042
    - path: src/feat_gen.py
      hash: md5
      md5: 17ceeec288ac7d047c1a2897a7d97e86
      size: 855
    - path: src/spec_funcs.py
      hash: md5
      md5: 37b812b0068e8e74d6ac94566c27e0a2
      size: 18142
    params:
      params.yaml:
        feat_gen.add_individual_thresh: 0.65
        feat_gen.binary: false
        feat_gen.feat_strategy: count
        feat_gen.ind_sel_tree_max_depth: 5
        feat_gen.logreg_c: 0.05
        feat_gen.max_df: 0.3
        feat_gen.max_features:
        feat_gen.min_df: 10
        feat_gen.tree_maxdepth: 5
        seed: 0
        val_only_proc: false
        val_ts_size: 0.15
    outs:
    - path: data/interim/data_df.csv
      hash: md5
      md5: 697bc608485d546a6169e1a8fc1f2b3c
      size: 10404233
    - path: data/interim/feat_df.csv
      hash: md5
      md5: e370bccb5d5771d962f2b79610316976
      size: 45461396
    - path: data/interim/vec.pkl
      hash: md5
      md5: 1ad69fb11e497787a79fc670449a6878
      size: 111226
  feature_engineering:
    cmd: python src/feat_eng.py params.yaml
    deps:
    - path: data/interim/data_df.csv
      hash: md5
      md5: 697bc608485d546a6169e1a8fc1f2b3c
      size: 10404233
    - path: data/interim/feat_df.csv
      hash: md5
      md5: e370bccb5d5771d962f2b79610316976
      size: 45461396
    - path: data/interim/vec.pkl
      hash: md5
      md5: 1ad69fb11e497787a79fc670449a6878
      size: 111226
    - path: src/feat_eng.py
      hash: md5
      md5: b77e651e25a7320bec2bd719ab6ee065
      size: 411
    params:
      params.yaml:
        feat_eng.add_clust_feat: false
        feat_eng.add_ind_cols: true
        feat_eng.add_topic_feat:
        feat_eng.tfidf_dim:
        feat_eng.topic_algo: lsa
        seed: 0
    outs:
    - path: data/out/feat_final_df.csv
      hash: md5
      md5: 5b1efcf08a37ee46ab35e0d26e023448
      size: 45569562
  train_eval_model:
    cmd: python src/train_eval_model.py params.yaml
    deps:
    - path: data/out/feat_final_df.csv
      hash: md5
      md5: 684f32228d2f23ca607a912ca6cd5f86
      size: 45623652
    - path: src/train_eval_model.py
      hash: md5
      md5: 944b3917686abe2491b7f92f42908038
      size: 454
    params:
      params.yaml:
        seed: 0
        train_eval_model.attack_clf: inc
        train_eval_model.balanced:
        train_eval_model.chain: true
        train_eval_model.model: logreg
        train_eval_model.opt_metric: f1
    outs:
    - path: data/out/by_class_metric.csv
      hash: md5
      md5: c8e8d87ec5be7ade4c4ad63874eece08
      size: 482
    - path: data/out/conf_df.csv
      hash: md5
      md5: 93c0ae9b31a6ed1984a34b7ea5e42252
      size: 192467
    - path: data/out/confusion_matrix.png
      hash: md5
      md5: 7f8cd8c9563f9ae89653ff3f2cafa889
      size: 116544
    - path: data/out/confusion_matrix_main_er.png
      hash: md5
      md5: 30627dae8e7a351e017a5fb2390fc2e2
      size: 97236
    - path: data/out/m.json
      hash: md5
      md5: d8c0705d1f3e57bf9421b720a361c686
      size: 138
    - path: data/out/m_other.json
      hash: md5
      md5: 91721907219495f93373ae3d1247f023
      size: 557
    - path: data/out/model.pkl
      hash: md5
      md5: e07edb215f9365a91009445cf82e6017
      size: 115199
    - path: data/out/opt_metric.csv
      hash: md5
      md5: be8ae87fb5d077ab2ed93804edd6b58b
      size: 18474
  train_conv_model:
    cmd: dvc repro dvc_pipes/train_conv_emb/dvc.yaml
  train_bert_model:
    cmd: dvc repro dvc_pipes/train_bert_emb/dvc.yaml
