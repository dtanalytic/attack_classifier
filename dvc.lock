schema: '2.0'
stages:
  get_mitre_data:
    cmd: python src/get_mitre_data.py params.yaml
    deps:
    - path: data/external/enterprise-attack.json
      hash: md5
      md5: c94cce0ee047d11c5c4a7475259e04f6
      size: 44231946
    - path: src/get_mitre_data.py
      hash: md5
      md5: f7ff9e12b51fe79da2635d97847a1703
      size: 5719
    params:
      params.yaml:
        get_data.divide_paras: true
    outs:
    - path: data/interim/label2tactic.json
      hash: md5
      md5: 5189286c02d7aa1ba4b5542d14a5f4aa
      size: 24536
    - path: data/interim/mitre.csv
      hash: md5
      md5: 52936e543e9670900e67964262f23edb
      size: 7876768
    - path: data/interim/mitre_attack.csv
      hash: md5
      md5: d4efdab171ee40b62ecee3b861353b05
      size: 3090191
  get_add_data:
    cmd: python src/get_add_data.py params.yaml
    deps:
    - path: data/external/dataset.txt
      hash: md5
      md5: d0a5e5ec3a635aaa4277acef01371c13
      size: 1860959
    - path: data/external/multi_label.json
      hash: md5
      md5: 4e37ce4f0d60fb6c51d1c40ecee4dc12
      size: 5987464
    - path: data/external/rep_dn
      hash: md5
      md5: 8a078ab32bbba7bce63fc56078b66804.dir
      size: 742875
      nfiles: 25
    - path: data/interim/label2tactic.json
      hash: md5
      md5: 5189286c02d7aa1ba4b5542d14a5f4aa
      size: 24536
    - path: data/interim/mitre.csv
      hash: md5
      md5: 52936e543e9670900e67964262f23edb
      size: 7876768
    - path: data/interim/mitre_attack.csv
      hash: md5
      md5: d4efdab171ee40b62ecee3b861353b05
      size: 3090191
    - path: src/get_add_data.py
      hash: md5
      md5: b6ea9418087c99298eb086bd2b30fbe4
      size: 4853
    params:
      params.yaml:
        get_data.add_empty_reports: false
        get_data.data_fn: data/interim/mitre_full_df.csv
        get_data.target: tactic
        get_data.use_alt_mitre: false
        get_data.use_reports_f: true
        get_data.use_tram_f: true
    outs:
    - path: data/interim/mitre_full_df.csv
      hash: md5
      md5: fa87c49257af7a84f36d21d059f9cda7
      size: 6637971
  manual_data_filter:
    cmd: python src/manual_data_filter.py params.yaml
    deps:
    - path: data/interim/mitre_full_df.csv
      hash: md5
      md5: fa87c49257af7a84f36d21d059f9cda7
      size: 6637971
    - path: src/manual_data_filter.py
      hash: md5
      md5: da91c10e74fecef2c77f97ac086ebd36
      size: 935
    outs:
    - path: data/interim/mitre_full_filt_df.csv
      hash: md5
      md5: b05480d2c28ee1318301331c8ba3bc57
      size: 6641361
  text_preprocess:
    cmd: python src/prep.py params.yaml
    deps:
    - path: data/interim/mitre_full_filt_df.csv
      hash: md5
      md5: b05480d2c28ee1318301331c8ba3bc57
      size: 6641361
    - path: src/prep.py
      hash: md5
      md5: 1a109950070a3d336db7d03a9ba1d82a
      size: 5225
    - path: src/spec_funcs.py
      hash: md5
      md5: ba6e4fcee652c7e6160bffdb26204e74
      size: 18413
    params:
      params.yaml:
        prep_text.labelled_text_only: false
        prep_text.lower: false
        prep_text.max_len_token: 10
        prep_text.min_len_token: 3
        prep_text.replace_entities: true
        prep_text.save_only_words: false
        prep_text.stem_lemm: stem
        prep_text.stop_words: false
        prep_text.ttp_counts_thresh: 15
    outs:
    - path: data/interim/mlb.pkl
      hash: md5
      md5: 59aa9a82e455e7fed9a95b929105bcb9
      size: 1386
    - path: data/interim/prep_df.csv
      hash: md5
      md5: 7a37136d24eb7850d7899c25bb5438f3
      size: 28696892
    - path: data/interim/ttp/mlb.pkl
      hash: md5
      md5: 05d07416a5427bd64a0a618f5b0e78b5
      size: 3484
  feature_generation:
    cmd: python src/feat_gen.py params.yaml
    deps:
    - path: data/interim/mlb.pkl
      hash: md5
      md5: 59aa9a82e455e7fed9a95b929105bcb9
      size: 1386
    - path: data/interim/prep_df.csv
      hash: md5
      md5: 7a37136d24eb7850d7899c25bb5438f3
      size: 28696892
    - path: src/feat_gen.py
      hash: md5
      md5: 3a6ccdb8ce0c25554cf3fb95ef04db3a
      size: 921
    - path: src/spec_funcs.py
      hash: md5
      md5: ba6e4fcee652c7e6160bffdb26204e74
      size: 18413
    params:
      params.yaml:
        feat_gen.add_individual_thresh: 0.65
        feat_gen.binary: false
        feat_gen.feat_strategy: count
        feat_gen.ind_sel_tree_max_depth: 5
        feat_gen.logreg_c: 0.05
        feat_gen.max_df: 0.3
        feat_gen.max_features:
        feat_gen.min_df: 10
        feat_gen.tree_maxdepth: 5
        seed: 0
        val_only_proc: false
        val_ts_size: 0.15
    outs:
    - path: data/interim/data_df.csv
      hash: md5
      md5: e4360e3d57624c4690ef454a20a4d86b
      size: 11143993
    - path: data/interim/feat_df.csv
      hash: md5
      md5: 7865df1bfe804ff93bf8b4acf0f97b28
      size: 49915635
    - path: data/interim/vec.pkl
      hash: md5
      md5: 1138aaeca161e019a286d0719b5e17ba
      size: 119515
  feature_engineering:
    cmd: python src/feat_eng.py params.yaml
    deps:
    - path: data/interim/data_df.csv
      hash: md5
      md5: e4360e3d57624c4690ef454a20a4d86b
      size: 11143993
    - path: data/interim/feat_df.csv
      hash: md5
      md5: 7865df1bfe804ff93bf8b4acf0f97b28
      size: 49915635
    - path: data/interim/vec.pkl
      hash: md5
      md5: 1138aaeca161e019a286d0719b5e17ba
      size: 119515
    - path: src/feat_eng.py
      hash: md5
      md5: b77e651e25a7320bec2bd719ab6ee065
      size: 411
    params:
      params.yaml:
        feat_eng.add_clust_feat: false
        feat_eng.add_ind_cols: true
        feat_eng.add_topic_feat:
        feat_eng.tfidf_dim:
        feat_eng.topic_algo: lsa
        seed: 0
    outs:
    - path: data/out/feat_final_df.csv
      hash: md5
      md5: a6fa161b1411a5cafe2afa956aca8f1c
      size: 50038493
  train_eval_model:
    cmd: python src/train_eval_model.py params.yaml
    deps:
    - path: data/out/feat_final_df.csv
      hash: md5
      md5: a6fa161b1411a5cafe2afa956aca8f1c
      size: 50038493
    - path: src/train_eval_model.py
      hash: md5
      md5: 174f0a4ae62c36a134edd4d6162b4dfc
      size: 473
    params:
      params.yaml:
        seed: 0
        train_eval_model.attack_clf:
        train_eval_model.balanced:
        train_eval_model.chain: true
        train_eval_model.model: logreg
        train_eval_model.opt_metric: f1
    outs:
    - path: data/out/by_class_metric.csv
      hash: md5
      md5: b8b22c22059ab963336b508fa5b816d0
      size: 498
    - path: data/out/conf_df.csv
      hash: md5
      md5: f3322d0b6e82f158a4b095ad895c5fdb
      size: 218859
    - path: data/out/confusion_matrix.png
      hash: md5
      md5: 1251e50fd27c04cac374cae9d8272661
      size: 116865
    - path: data/out/confusion_matrix_main_er.png
      hash: md5
      md5: ec0f51c68159bec8dee1ab67f1297bcc
      size: 92264
    - path: data/out/m.json
      hash: md5
      md5: a2c345c46a73dd2a8478bf5f464d3be8
      size: 138
    - path: data/out/m_other.json
      hash: md5
      md5: 0bda52a6add51cfd118ba613e2fa0c70
      size: 557
    - path: data/out/model.pkl
      hash: md5
      md5: ad4a3d4eea7a526d6645071e1c9b20ed
      size: 111487
    - path: data/out/opt_metric.csv
      hash: md5
      md5: c4bb33df35141e8cc3a648fb6b4b017c
      size: 21389
  train_conv_model:
    cmd: dvc repro dvc_pipes/train_conv_emb/dvc.yaml
  train_bert_model:
    cmd: dvc repro dvc_pipes/bert/dvc.yaml
  train_ttp_classic_model:
    cmd: dvc repro dvc_pipes/ttp/dvc.yaml
  train_ttp_bert_model:
    cmd: dvc repro dvc_pipes/bert_ttp/dvc.yaml
